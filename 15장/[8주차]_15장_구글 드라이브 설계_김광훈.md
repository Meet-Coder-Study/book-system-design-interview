# 14장. 구글 드라이브 설계
## 1. 요구 사항
- (1)파일 추가
- (2) 파일 다운로드
- (3) 여러 단말에 파일 동기화
- (4) 파일 갱신 이력 조회
- (5) 파일 공유
- (6) 파일 편집 & 삭제 알림 표시

## 2. API
- (1) 파일 업로드 API
- (2) 파일 다운로드 API
- (3) 파일 갱신 히스토리 API

## 3. 한 대 서버의 제약 극복
- TODO: Img

- 로드밸런서: 트래픽 분산
- 웹 서버: 로드밸런서가 있다면, 웹 서버 쉽게 추가 가능
- 메타데이터 DB: 파일 저장 서버에서 분리 -> SPOF 회피 -> + 다중화, 샤딩 -> 가용성, 규모 확장 대응
- 파일 저장소: S3 저장소 사용 -> 두 개 이상의 지역에 데이터를 다중화

<br>

## 4. 동기화 충돌
- 버전으로 해결한다.
- 즉 두 가지 버전 중 합칠지 아니면 대체할지 결정한다.

<br>

## 5. 블록 저장소 서버
- 파일 블록을 클라우드 저장소에 업로드하는 서버
- 파일 하나를 여러개의 블록으로 나눠 저장 -> 각 블록 고유 해시값 할당 
- Example) S3


#### (1) 델타 동기화
- 파일이 수정되면 전체 파일 대신 수정이 일어난 블록만 동기화 

#### (2) 압축 
- 블록 단위로 압축하면 데이터 크기를 많이 줄일 수 있다.
- 압축 알고리즘: gzip, bzip2 등

<br>

## 6. 높은 일관성 요구사항
- 강한 일관성 모델(strong consistency)을 기본으로 한다.
- 같은 파일이 단말이나 사용자에 따라 다르게 보이는 것은 허용할 수 없다.
- 메타데이터 캐시와 데이터베이스 계층에서 같은 원칙이 적용되어야함
- 메모리 캐시는 보통 최종 일관성(eventual consistency) 모델을 지원한다. -> ACID 지원 x -> 애플리케이션에서 구현
- 따라서 추가 요구 사항을 만족시켜야 한다.
    - 캐시는 데이터베이스에 있는 원본과 일치
    - 원본 변경 -> 캐시 데이터 무효 

<br>

## 6. 알림 서비스

<br>

## 7. 저장소 공간 절약

